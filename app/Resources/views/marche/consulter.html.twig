{% extends 'base.html.twig' %}
{% block head %}
    {{ parent() }}

    <style>
        .validation {
            border:8px solid yellow;

            background-color: red;
            color: white;

        }
    </style>
{% endblock %}
{% block main %}
    <!-- Chart Modal -->
    <div class="modal fade" id="modal-chart" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <!--Header-->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <!--Body-->
                <div id="modalcont" class="modal-body">
                    <canvas id="myChart"></canvas>
                </div>
                <!--Footer-->
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="modal-xl" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <!--Header-->
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Presence {{ datee }}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <!--Body-->
                <div id="modalcont" class="modal-body">
                    <div class="table-responsive">
                            <table id="example1" class="table">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nom</th>
                                    <th>Prenom</th>
                                    <th>Present</th>
                                    <th>Absent</th>
                                    <th>Repos</th>
                                    <th>Jour / Nuit</th>
                                    <th>type</th>

                                </tr>
                                </thead>
                                <tbody>
                                {% for emp in listEmp %}
                                    <tr id="validation{{ emp.idEmp  }}">
                                        <td id="{{ emp.idEmp }}">{{ emp.idEmp }}</td>
                                        <td>{{ emp.nom }}</td>
                                        <td>{{ emp.prenom }}</td>
                                        <td><input type="checkbox"  name="scales{{ emp.idEmp  }}" value="1"/></td>
                                        <td><input type="checkbox"  name="scales{{ emp.idEmp  }}" value="0"/></td>
                                        <td><input type="checkbox"  name="scales{{ emp.idEmp  }}" value="2"/></td>
                                        <td><select class="form-control" id="journuit{{ emp.idEmp  }}">
                                                <option value="jour">Jour</option>
                                                <option value="nuit">Nuit</option>
                                            </select></td>
                                        <td></td>
                                    </tr>

                                {% endfor %}

                                {% for affection in affectations %}
                                    <tr style="background-color: #ECE1AE">
                                        <td id="{{ affection.idAgent.idEmp }}">{{ affection.idAgent.idEmp }}</td>
                                        <td>{{ affection.idAgent.nom }}</td>
                                        <td>{{ affection.idAgent.prenom }}</td>
                                        <td><input type="checkbox"  name="agent{{ affection.idAgent.idEmp  }}" value="1"/></td>
                                        <td><input type="checkbox"  name="agent{{ affection.idAgent.idEmp  }}" value="0"/></td>
                                        <td><input type="checkbox"  name="agent{{ affection.idAgent.idEmp  }}" value="2"/></td>
                                        <td><select class="form-control" id="agentjournuit{{ affection.idAgent.idEmp  }}">
                                                <option value="{{affection.type}}">{{affection.type}}</option>
                                            </select></td>
                                        <td style="color: darkslateblue"><b>{{ affection.role }}</b></td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>


                </div>
                <!--Footer-->
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Close</button>
                    <button type="button" onclick="return EnregisterAbsence()" class="btn btn-primary">Enregistrer</button>
                </div>
                <center> <p style="color:red;" id="lignemanquante" hidden>Ligne manquante</p></center>
            </div>
        </div>
    </div>

    <!-- Modal Modifier -->
    <div class="modal fade" id="modal-xl-2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <!--Header-->
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Presence {{ datee}}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <!--Body-->
                <div id="modalcont" class="modal-body">
                    <div class="table-responsive">
                        <table id="example3" class="table table-hover">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Nom</th>
                                <th>Prenom</th>
                                <th>Present</th>
                                <th>Absent</th>
                                <th>Repos</th>
                                <th>Jour / Nuit</th>
                                <th>Role</th>

                            </tr>
                            </thead>
                            <tbody>
                            {% for p in todayPresence %}
                                {% if p.idAgent %}
                                    <tr onchange="return latest(this)">
                                        <td id="{{ p.idAgent.idEmp }}">{{ p.idAgent.idEmp }}</td>
                                        <td>{{ p.idAgent.nom }}</td>
                                        <td>{{ p.idAgent.prenom }}</td>
                                        {% if p.etat == 1 %}
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="1" checked/></td>
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="0" /></td>
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="2" /></td>
                                        {%  elseif p.etat == 0  %}
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="1"/></td>
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="0" checked/></td>
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="2" /></td>
                                        {% else %}
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="1"/></td>
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="0" /></td>
                                            <td><input type="checkbox" id="agent{{ p.idAgent.idEmp  }}" name="agent{{ p.idAgent.idEmp  }}" value="2" checked/></td>
                                        {% endif %}
                                        <td><select class="form-control" id="agentjournuit{{ p.idAgent.idEmp  }}">
                                                <option value="{{p.type}}">{{p.type}}</option>
                                            </select></td>
                                        <td></td>
                                    </tr>
                                {% else %}
                                        <tr onchange="return latest(this)">
                                            <td id="{{ p.idEmp.idEmp }}">{{ p.idEmp.idEmp }}</td>
                                            <td>{{ p.idEmp.nom }}</td>
                                            <td>{{ p.idEmp.prenom }}</td>
                                            {% if p.etat == 1 %}
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="1" checked/></td>
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="0" /></td>
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="2" /></td>
                                            {%  elseif p.etat == 0  %}
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="1"/></td>
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="0" checked/></td>
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="2" /></td>
                                            {% else %}
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="1"/></td>
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="0" /></td>
                                                <td><input type="checkbox" id="scales{{ p.idEmp.idEmp  }}" name="scales{{ p.idEmp.idEmp  }}" value="2" checked/></td>
                                            {% endif %}
                                            <td><select class="form-control" id="journuit{{ p.idEmp.idEmp  }}">
                                                    <option value="{{p.type}}">{{p.type}}</option>
                                                </select></td>
                                            <td></td>
                                        </tr>

                                {% endif %}

                            {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>
                <!--Footer-->
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Close</button>
                    <button type="button" onclick="return ModifierAbsence()" class="btn btn-primary">Modifier</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <section class="content">

        <div class="container-fluid">

            <div class="row">
                <div class="col-12">
                    <div class="card card-primary card-tabs">
                        <div class="card-header p-0 pt-1">
                            <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="custom-tabs-one-home-tab" data-toggle="pill" href="#custom-tabs-one-home" role="tab" aria-controls="custom-tabs-one-home" aria-selected="true">Presence</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="custom-tabs-one-profile-tab" data-toggle="pill" href="#custom-tabs-one-profile" role="tab" aria-controls="custom-tabs-one-profile" aria-selected="false">List des employes</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="custom-tabs-one-messages-tab" data-toggle="pill" href="#custom-tabs-one-messages" role="tab" aria-controls="custom-tabs-one-messages" aria-selected="false">Rapport</a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="custom-tabs-one-tabContent">
                                <div class="tab-pane fade show active" id="custom-tabs-one-home" role="tabpanel" aria-labelledby="custom-tabs-one-home-tab">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="card">
                                                <div class="card-header border-transparent">
                                                    <label><b>Date : </b></label>
                                                    <input id="taherDate" value="{{ datee}}" class="form-group col-md-6" type="date" max='{{ "now"|date("Y-m-d") }}' />

                                                    {% if todayPresence is empty %}

                                                        <button style="float: right" type="button" class="btn btn-success col-md-2" data-toggle="modal" data-target="#modal-xl"><i class="fa fa-plus" aria-hidden="true"></i> Ajouter Presence</button>

                                                    {% else  %}
                                                        <button style="float: right" type="button" class="btn btn-primary col-md-2" data-toggle="modal" data-target="#modal-xl-2"><i class="fa fa-plus" aria-hidden="true"></i> Modifier Presence</button>

                                                    {% endif %}
                                                    <div class="card-tools">

                                                    </div>

                                                </div>
                                                <!-- /.card-header -->
                                                <div class="card-body p-0">
                                                    <div class="table-responsive">
                                                        <table id="example2" class="table m-0">
                                                            <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>Nom</th>
                                                                <th>Prenom</th>
                                                                <th>Etat</th>
                                                                <th>Jour / Nuit</th>
                                                                <th>Role</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            {% for p in todayPresence %}
                                                                {% if p.idAgent %}
                                                                    <tr style="background-color: #ECE1AE">
                                                                        <td>{{ p.idAgent.idEmp }}</td>
                                                                        <td style="font-size: 20px">{{ p.idAgent.nom }}</td>
                                                                        <td style="font-size: 20px">{{ p.idAgent.prenom }}</td>

                                                                        {% if  p.etat == 1 %}
                                                                            <td style="font-size: 20px"><span class="badge badge-success">Present</span></td>

                                                                        {% elseif  p.etat == 0 %}
                                                                            <td style="font-size: 20px"><span class="badge badge-danger">Absent</span></td>
                                                                        {% else  %}
                                                                            <td style="font-size: 20px"><span class="badge badge-warning">Repos</span></td>
                                                                        {% endif %}
                                                                        {% if p.type == "nuit" %}
                                                                            <td style="font-size: 20px"><span class="badge badge-dark">{{ p.type }}</span></td>
                                                                        {% else  %}
                                                                            <td style="font-size: 20px"><span class="badge badge-info">{{ p.type }}</span></td>
                                                                        {% endif %}
                                                                        <td style="color: darkslateblue"><b>
                                                                                {% for aff in affectations %}
                                                                                    {% if aff.idAgent == p.idAgent %}
                                                                                    {{ aff.role }}
                                                                        {% endif %}
                                                                                {% endfor %}
                                                                            </b></td>
                                                                    </tr>
                                                                {% else %}
                                                                    <tr>
                                                                        <td>{{ p.idEmp.idEmp }}</td>
                                                                        <td style="font-size: 20px">{{ p.idEmp.nom }}</td>
                                                                        <td style="font-size: 20px">{{ p.idEmp.prenom }}</td>

                                                                        {% if  p.etat == 1 %}
                                                                            <td style="font-size: 20px"><span class="badge badge-success">Present</span></td>

                                                                        {% elseif  p.etat == 0 %}
                                                                            <td style="font-size: 20px"><span class="badge badge-danger">Absent</span></td>
                                                                        {% else  %}
                                                                            <td style="font-size: 20px"><span class="badge badge-warning">Repos</span></td>
                                                                        {% endif %}
                                                                        {% if p.type == "nuit" %}
                                                                        <td style="font-size: 20px"><span class="badge badge-dark">{{ p.type }}</span></td>
                                                                        {% else  %}
                                                                            <td style="font-size: 20px"><span class="badge badge-info">{{ p.type }}</span></td>
                                                                            {% endif %}
                                                                            <td></td>
                                                                    </tr>

                                                            {% endif %}
                                                            {% endfor %}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!-- /.table-responsive -->
                                                </div>
                                                <!-- /.card-body -->
                                                <!-- /.card-footer -->
                                            </div></div>
                                        <!-- Default box -->


                                        <!-- /.card -->


                                    </div>
                                </div>
                                <div class="tab-pane fade" id="custom-tabs-one-profile" role="tabpanel" aria-labelledby="custom-tabs-one-profile-tab">
                                    <div class="col-md-12">
                                        <!-- USERS LIST -->
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="card-title">List des Employes</h3>

                                                <div class="card-tools">
                                                    <span class="badge badge-danger">8 New Members</span>
                                                    <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <!-- /.card-header -->
                                            <div class="card-body p-0">
                                                <div class="table-responsive">
                                                    <table id="example1" class="table">
                                                        <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Nom</th>
                                                            <th>Prenom</th>
                                                            <th>Action</th>


                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for emp in listEmp %}
                                                            <tr id="validation{{ emp.idEmp  }}">
                                                                <td id="{{ emp.idEmp }}">{{ emp.idEmp }}</td>
                                                                <td>{{ emp.nom }}</td>
                                                                <td>{{ emp.prenom }}</td>
                                                                <td><button class="btn btn-primary">Ajouter Avance</button></td>
                                                            </tr>

                                                        {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <!-- /.users-list -->
                                            </div>
                                            <!-- /.card-body -->
                                            <div class="card-footer text-center">
                                                <a href="javascript::">View All Users</a>
                                            </div>
                                            <!-- /.card-footer -->
                                        </div>
                                        <!--/.card -->
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="custom-tabs-one-messages" role="tabpanel" aria-labelledby="custom-tabs-one-messages-tab">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <div class="input-group date" id="reservationdate" data-target-input="nearest">
                                                <input id="monthYear" type="text" class="form-control datetimepicker-input" data-target="#reservationdate"/>
                                                <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
                                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                </div>
                                                <button class="btn btn-success" onclick="return SearchRendement(this)"><i class="fa fa-search" aria-hidden="true"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    <button style="float: right" type="button" class="btn btn-success col-md-2" data-toggle="modal" data-target="#modal-chart">Chart</button>

                                    <div class="table-responsive">
                                        <table id="example4" class="table table-bordered table-striped m-0 ">
                                            <thead class="thead-dark">
                                            <tr>
                                                <th>#</th>
                                                <th>Nom</th>
                                                <th>Prenom</th>
                                                <th>Total Presence</th>
                                                <th>Total Absence</th>
                                                <th>Total Repos</th>
                                                <th>Salaire a payer</th>
                                            </tr>
                                            </thead>
                                            <tbody style="font-size: 18px">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- /.card -->
                        </div>
                    </div>

                </div>

            </div>



    </section>

{% endblock %}

{% block javascript %}
{{ parent() }}
<script src="{{ asset('admin/plugins/jquery/jquery.min.js') }}"></script>
<!-- jQuery UI -->
<script src="{{ asset('admin/plugins/jquery-ui/jquery-ui.min.js') }}"></script>

    <script src="{{ asset('admin/plugins/fullcalendar/main.min.js') }}"></script>
    <script src="{{ asset('admin/plugins/fullcalendar-daygrid/main.min.js') }}"></script>
    <script src="{{ asset('admin/plugins/fullcalendar-timegrid/main.min.js') }}"></script>
    <script src="{{ asset('admin/plugins/fullcalendar-interaction/main.min.js') }}"></script>
    <script src="{{ asset('admin/plugins/fullcalendar-bootstrap/main.min.js') }}"></script>

<!-- Bootstrap 4 -->
<script src="{{ asset('admin/plugins/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
<!-- Select2 -->
<script src="{{ asset('admin/plugins/select2/js/select2.full.min.js') }}"></script>
<!-- Bootstrap4 Duallistbox -->
<script src="{{ asset('admin/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js') }}"></script>
<!-- InputMask -->
<script src="{{ asset('admin/plugins/moment/moment.min.js') }}"></script>
<script src="{{ asset('admin/plugins/inputmask/min/jquery.inputmask.bundle.min.js') }}"></script>
<!-- date-range-picker -->
<script src="{{ asset('admin/plugins/daterangepicker/daterangepicker.js') }}"></script>
<!-- bootstrap color picker -->
<script src="{{ asset('admin/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js') }}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="{{ asset('admin/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js') }}"></script>
<!-- Bootstrap Switch -->
<script src="{{ asset('admin/plugins/bootstrap-switch/js/bootstrap-switch.min.js') }}"></script>
<!-- AdminLTE App -->
<script src="{{ asset('admin/dist/js/adminlte.min.js') }}"></script>
<!-- AdminLTE for demo purposes -->
<script src="{{ asset('admin/dist/js/demo.js') }}"></script>

<!-- DataTables -->
<script src="{{ asset('admin/plugins/datatables/jquery.dataTables.min.js') }}"></script>
<script src="{{ asset('admin/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js') }}"></script>
<script src="{{ asset('admin/plugins/datatables-responsive/js/dataTables.responsive.min.js') }}"></script>
<script src="{{ asset('admin/plugins/datatables-responsive/js/responsive.bootstrap4.min.js') }}"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.flash.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.print.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"></script>
    <!-- Page specific script -->
    <script>

    $(document).ready( function () {
    $("#example1").DataTable({
      "responsive": true,
      "autoWidth": false,
    });

     $("#example2").DataTable({
      "responsive": true,
      "autoWidth": false,
      "info":false
    });

     $("#example3").DataTable({
      "responsive": true,
      "autoWidth": false,
      "info":false
    });

      $("#example4").DataTable({
      dom: 'Bfrtip',
         buttons: [
            {
                extend: 'pdfHtml5',
                messageTop: 'PDF created by PDFMake with Buttons for DataTables.',
                className: 'btn btn-info glyphicon glyphicon-search'

            },
            {
                 extend: 'excelHtml5',
                messageTop: 'PDF created by PDFMake with Buttons for DataTables.',
                className: 'btn btn-info glyphicon glyphicon-search'
            }
        ],
      "responsive": true,
      "autoWidth": false,
      "info":false,
      "bPaginate": false
    });

} );
    $(function () {

        /* initialize the external events
         -----------------------------------------------------------------*/
        function ini_events(ele) {
            ele.each(function () {

                // create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
                // it doesn't need to have a start or end
                var eventObject = {
                    title: $.trim($(this).text()) // use the element's text as the event title
                }

                // store the Event Object in the DOM element so we can get to it later
                $(this).data('eventObject', eventObject)

                // make the event draggable using jQuery UI
                $(this).draggable({
                    zIndex        : 1070,
                    revert        : true, // will cause the event to go back to its
                    revertDuration: 0  //  original position after the drag
                })

            })
        }

        ini_events($('#external-events div.external-event'))

        /* initialize the calendar
         -----------------------------------------------------------------*/
        //Date for the calendar events (dummy data)
        var date = new Date()
        var d    = date.getDate(),
            m    = date.getMonth(),
            y    = date.getFullYear()

        var Calendar = FullCalendar.Calendar;
        var Draggable = FullCalendarInteraction.Draggable;

        var containerEl = document.getElementById('external-events');
        var checkbox = document.getElementById('drop-remove');
        var calendarEl = document.getElementById('calendar');

        // initialize the external events
        // -----------------------------------------------------------------

        new Draggable(containerEl, {
            itemSelector: '.external-event',
            eventData: function(eventEl) {
                console.log(eventEl);
                return {
                    title: eventEl.innerText,
                    backgroundColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
                    borderColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
                    textColor: window.getComputedStyle( eventEl ,null).getPropertyValue('color'),
                };
            }
        });

        var calendar = new Calendar(calendarEl, {
            plugins: [ 'bootstrap', 'interaction', 'dayGrid', 'timeGrid' ],
            header    : {
                left  : 'prev,next today',
                center: 'title',
                right : 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            'themeSystem': 'bootstrap',
            //Random default events
            events    : [
                {
                    title          : 'All Day Event',
                    start          : new Date(y, m, 1),
                    backgroundColor: '#f56954', //red
                    borderColor    : '#f56954', //red
                    allDay         : true
                },
                {
                    title          : 'Long Event',
                    start          : new Date(y, m, d - 5),
                    end            : new Date(y, m, d - 2),
                    backgroundColor: '#f39c12', //yellow
                    borderColor    : '#f39c12' //yellow
                },
                {
                    title          : 'Meeting',
                    start          : new Date(y, m, d, 10, 30),
                    allDay         : false,
                    backgroundColor: '#0073b7', //Blue
                    borderColor    : '#0073b7' //Blue
                },
                {
                    title          : 'Lunch',
                    start          : new Date(y, m, d, 12, 0),
                    end            : new Date(y, m, d, 14, 0),
                    allDay         : false,
                    backgroundColor: '#00c0ef', //Info (aqua)
                    borderColor    : '#00c0ef' //Info (aqua)
                },
                {
                    title          : 'Birthday Party',
                    start          : new Date(y, m, d + 1, 19, 0),
                    end            : new Date(y, m, d + 1, 22, 30),
                    allDay         : false,
                    backgroundColor: '#00a65a', //Success (green)
                    borderColor    : '#00a65a' //Success (green)
                },
                {
                    title          : 'Click for Google',
                    start          : new Date(y, m, 28),
                    end            : new Date(y, m, 29),
                    url            : 'http://google.com/',
                    backgroundColor: '#3c8dbc', //Primary (light-blue)
                    borderColor    : '#3c8dbc' //Primary (light-blue)
                }
            ],
            editable  : true,
            droppable : true, // this allows things to be dropped onto the calendar !!!
            drop      : function(info) {
                // is the "remove after drop" checkbox checked?
                if (checkbox.checked) {
                    // if so, remove the element from the "Draggable Events" list
                    info.draggedEl.parentNode.removeChild(info.draggedEl);
                }
            }
        });

        calendar.render();
        // $('#calendar').fullCalendar()

        /* ADDING EVENTS */
        var currColor = '#3c8dbc' //Red by default
        //Color chooser button
        var colorChooser = $('#color-chooser-btn')
        $('#color-chooser > li > a').click(function (e) {
            e.preventDefault()
            //Save color
            currColor = $(this).css('color')
            //Add color effect to button
            $('#add-new-event').css({
                'background-color': currColor,
                'border-color'    : currColor
            })
        })
        $('#add-new-event').click(function (e) {
            e.preventDefault()
            //Get value and make sure it is not null
            var val = $('#new-event').val()
            if (val.length == 0) {
                return
            }

            //Create events
            var event = $('<div />')
            event.css({
                'background-color': currColor,
                'border-color'    : currColor,
                'color'           : '#fff'
            }).addClass('external-event')
            event.html(val)
            $('#external-events').prepend(event)

            //Add draggable funtionality
            ini_events(event)

            //Remove event from text input
            $('#new-event').val('')
        })
    })
    </script>

    <script>
  $(function () {

    //Date range picker
    $('#reservationdate').datetimepicker({
        viewMode: 'years',
                format: 'MM/YYYY',
                maxDate: new Date(new Date().getFullYear(), new Date().getMonth()),

    });
    $('.datetimepicker-input').on('change', function(e){alert("test"); })

    $("input[data-bootstrap-switch]").each(function(){
      $(this).bootstrapSwitch('state', $(this).prop('checked'));
    });

  })

$(function() {

    $("input:checkbox").on('click', function() {
  // in the handler, 'this' refers to the box clicked on
  var $box = $(this);
  if ($box.is(":checked")) {
    // the name of the box is retrieved using the .attr() method
    // as it is assumed and expected to be immutable
    var group = "input:checkbox[name='" + $box.attr("name") + "']";
    // the checked state of the group/box on the other hand will change
    // and the current value is retrieved using .prop() method
    $(group).prop("checked", false);
    $box.prop("checked", true);
  } else {
    $box.prop("checked", false);
  }
});

$("#taherDate").on("change", function (e) {

  /*  let current_datetime = new Date($(this).val());
let formatted_date = current_datetime.getDate() + "-" + (current_datetime.getMonth() + 1) + "-" + current_datetime.getFullYear();
  alert(formatted_date);*/
var url = '{{ path("consulter_marcher", {'idMarche': 'idMarche' ,  'date': 'date' }) }}';
                url = url.replace("idMarche", {{ idMarche }});
                url = url.replace("date", $(this).val());
  window.location.replace(url);
});

});

</script>

<script>

function latest(thisRow){
    alert($(thisRow).val());
}

function checkValidation(){
    var test = true ;
    {% for emp in listEmp %}
     var i = 0 ;
      $("input:checkbox[name='scales{{ emp.idEmp }}']").each(function(){

            if($(this).prop("checked") == false){
                console.log("Checkbox is not checked.");
                i++;
            }

            else {
                $("#validation{{ emp.idEmp  }}").removeClass('validation');
            }

        });

      if ( i == 3 ){
          console.log("validation");
          $("#validation{{ emp.idEmp  }}").addClass('validation');
          $("#lignemanquante").show();
          test = false ;
      }

     {% endfor %}

     return test;
}

function EnregisterAbsenceAgentRotation(){
            {% for affectation in affectations %}
     $("input:checkbox[name='agent{{ affectation.idAgent.idEmp }}']").each(function()
{
    if($(this).is(':checked')){
               var url = '{{ path("presence_agent_api_new", {'idMarche': 'idMarche' ,  'idAgent': 'idAgent' , 'etat': 'etat' , 'date':'date' ,'type':'type'} ) }}';
                url = url.replace("idMarche", {{ idMarche }});
                url = url.replace("idAgent", {{ affectation.idAgent.idEmp }});
                url = url.replace("etat", $(this).val());
                url = url.replace("date", $("#taherDate").val());
                url = url.replace("type", $( "#agentjournuit{{ affectation.idAgent.idEmp }} option:selected" ).val());
                $.ajax({
                    url: url,
                    success: function(data) {
                    },
                    error: function() {
                        // show alert or something
                    },
                    complete: function(){
                    }
                });
    }
})
{% endfor %}

}

function EnregisterAbsenceAgentNormal(){


     //var test = checkValidation();



    $("#modal-xl").hide();
            {% for emp in listEmp %}
     $("input:checkbox[name='scales{{ emp.idEmp }}']").each(function()
{
    if($(this).is(':checked')){
        var url = '{{ path("presence_api_new", {'idMarche': 'idMarche' ,  'idEmp': 'idEmp' , 'etat': 'etat' , 'date':'date' ,'type':'type'} ) }}';
                url = url.replace("idMarche", {{ idMarche }});
                url = url.replace("idEmp", {{ emp.idEmp  }});
                url = url.replace("etat", $(this).val());
                url = url.replace("date", $("#taherDate").val());
                url = url.replace("type", $( "#journuit{{ emp.idEmp }} option:selected" ).val());


                $.ajax({
                    url: url,

                    success: function(data) {
                        location.reload();
                    },
                    error: function() {
                        // show alert or something
                    },

                    complete: function(){

                    }
                });

    }

})
{% endfor %}

}
    function EnregisterAbsence(){
          {% if affectations %}
        EnregisterAbsenceAgentRotation();
      {% endif %}
        EnregisterAbsenceAgentNormal();
    }

    function SearchRendement(bout){
        bout.disabled= true;

    var str = $("#monthYear").val();

var month = str.substring(0, str.lastIndexOf("/"));
var year = str.substring(str.lastIndexOf("/") + 1, str.length);

var dateSearch = year+"-"+month;
var table = $("#example4").DataTable();
table.clear().draw();

{% for emp in listEmp %}

                var url = '{{ path("total_absence_presence_par_mois", {'idMarche': 'idMarche' ,  'idEmp': 'idEmp' , 'date':'date'} ) }}';
                url = url.replace("idMarche", {{ idMarche }});
                url = url.replace("idEmp", {{ emp.idEmp  }});
                url = url.replace("date", dateSearch);

                $.ajax({
                    url: url,

                    success: function(data) {

                        if ($.trim(data)){
                             var rowNode = table.row.add( [
            {{ emp.idEmp  }},
            data.nom,
            data.Prenom,
            data.TotalPresence,
            data.TotalAbsence,
            data.TotalRepos,
            data.Salaire+" DT"
        ] ).draw( false );

                         }

                        else {


                        }

                        addData(data.nom , data.TotalPresence);

                    },
                    error: function() {
                        // show alert or something
                    },

                    complete: function(){
                        bout.disabled= false;
                    }
                });

                {% endfor %}




}


</script>
 <script type="text/javascript">
        $(function () {
            $('#datetimepicker10').datetimepicker({
                viewMode: 'years',
                format: 'MM/YYYY'
            });
        });
    </script>

    <script>
var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        datasets: [{
            label: '# of Votes',
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});

function CreateChart(){

}

function addData(label, data) {
    myChart.data.labels.push(label);
    myChart.data.datasets.forEach((dataset) => {
        dataset.data.push(data);
    });
    myChart.update();
}

function dynamicColors() {
    var r = Math.floor(Math.random() * 255);
    var g = Math.floor(Math.random() * 255);
    var b = Math.floor(Math.random() * 255);
    return "rgba(" + r + "," + g + "," + b + ", 0.5)";
}

function poolColors(a) {
    var pool = [];
    for(i = 0; i < a; i++) {
        pool.push(dynamicColors());
    }
    return pool;
}
</script>


{% endblock %}


